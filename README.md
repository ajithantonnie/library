# Library Management System

A Spring Boot REST API for managing library books and members.

## Features

- Book CRUD operations
- Member registration and management
- Book borrowing and returning
- JWT authentication
- Input validation
- Pagination support
- Swagger documentation
- MySQL and H2 database support

## Tech Stack

- Java 17
- Spring Boot 3.2.0
- Spring Security (OAuth2)
- Spring Data JPA
- MySQL / H2
- Maven
- JUnit 5, Mockito
- Swagger/OpenAPI

## Getting Started

### Requirements

- Java 17+
- Maven 3.6+
- MySQL (for production)

### Building the Application

```bash
# Clone the repository
git clone https://github.com/ajithantonnie/library.git
cd library

# Build the application
mvn clean install

# Run tests
mvn test
```

### Running the Application

#### Development Mode (with H2 Database)

**For Windows PowerShell:**
```powershell
$env:SPRING_PROFILES_ACTIVE='h2'; .\mvnw.cmd spring-boot:run
```

**For Linux/Mac:**
```bash
SPRING_PROFILES_ACTIVE=h2 ./mvnw spring-boot:run
```

#### Production Mode (with MySQL)
```powershell
# First, ensure MySQL is running and create the database
# The application will automatically create tables

# Windows PowerShell:
.\mvnw.cmd spring-boot:run

# Linux/Mac:
./mvnw spring-boot:run
```

The application will start on `http://localhost:8080`

## Authentication

The API uses JWT tokens for authentication.

For testing:
- Username: `user`
- Password: `password`

#### Example with curl:
```bash
curl -u user:password http://localhost:8080/api/books
```

### JWT Token 

For demonstration purposes, you can generate a JWT token using the auth endpoint:

#### 1. Generate a JWT Token:
```bash
curl -X POST http://localhost:8080/auth/token \
  -H "Content-Type: application/json" \
  -d '{"username": "testuser"}'
```

Response:
```json
{
  "token": "eyJhbGciOiJIUzI1NiJ9...",
  "type": "Bearer",
  "expires_in": "86400"
}
```

#### 2. Use the JWT Token:
```bash
curl -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9..." http://localhost:8080/api/books
```

**Note**: In production, JWT tokens should be generated by a proper OAuth2 authorization server.

## ðŸ“š API Endpoints

### Book Management

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/books` | Add a new book |
| GET | `/api/books` | Get all books (paginated) |
| GET | `/api/books/{id}` | Get a specific book |
| PUT | `/api/books/{id}` | Update book details |
| DELETE | `/api/books/{id}` | Delete a book |

### Member Management

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/members` | Register a new member |
| GET | `/api/members` | Get all members (paginated) |
| GET | `/api/members/{id}` | Get a specific member |
| PUT | `/api/members/{id}` | Update member details |
| DELETE | `/api/members/{id}` | Delete a member |

### Library Operations

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/borrow/{bookId}/member/{memberId}` | Borrow a book |
| POST | `/api/return/{bookId}` | Return a book |

### Authentication

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/auth/token` | Generate JWT token (demo purposes) |

### Pagination Parameters

For GET endpoints that return lists:
- `page` - Page number (default: 0)
- `size` - Page size (default: 10)

Example: `/api/books?page=0&size=5`

## ðŸ”§ API Usage Examples

### 1. Create a Book

```bash
curl -X POST http://localhost:8080/api/books \
  -H "Content-Type: application/json" \
  -H "Authorization: Basic dXNlcjpwYXNzd29yZA==" \
  -d '{
    "title": "The Great Gatsby",
    "author": "F. Scott Fitzgerald", 
    "isbn": "9780743273565"
  }'
```

### 2. Register a Member

```bash
curl -X POST http://localhost:8080/api/members \
  -H "Content-Type: application/json" \
  -H "Authorization: Basic dXNlcjpwYXNzd29yZA==" \
  -d '{
    "name": "John Doe",
    "email": "john.doe@example.com"
  }'
```

### 3. Borrow a Book

```bash
curl -X POST http://localhost:8080/api/borrow/1/member/1 \
  -H "Authorization: Basic dXNlcjpwYXNzd29yZA=="
```

### 4. Return a Book

```bash
curl -X POST http://localhost:8080/api/return/1 \
  -H "Authorization: Basic dXNlcjpwYXNzd29yZA=="
```

### 5. Get All Books (with pagination)

```bash
curl "http://localhost:8080/api/books?page=0&size=5" \
  -H "Authorization: Basic dXNlcjpwYXNzd29yZA=="
```

## ðŸ—„ Database Access

### H2 Console (Development)

When running with the H2 profile:
- **URL**: http://localhost:8080/h2-console
- **JDBC URL**: `jdbc:h2:mem:testdb`
- **Username**: `sa`
- **Password**: (leave blank)

### MySQL (Production)

- **URL**: `jdbc:mysql://localhost:3306/librarydb`
- **Username**: `root`
- **Password**: `password`

## ðŸ“– API Documentation

### Swagger UI
- **URL**: http://localhost:8080/swagger-ui.html
- Provides interactive API documentation and testing interface

### OpenAPI JSON
- **URL**: http://localhost:8080/v3/api-docs
- Raw OpenAPI 3 specification in JSON format

## Business Rules

- Books can only be borrowed if available
- Members must exist to borrow books
- Books can only be returned if currently borrowed

## Testing

```bash
# Run tests
mvn test
```

Includes unit and integration tests for services and controllers.

## Error Handling

The API provides consistent error responses:

### Error Response Format
```json
{
  "status": 404,
  "message": "Book not found with id: 1",
  "timestamp": "2025-11-16T10:30:00"
}
```

### HTTP Status Codes
- `200` - Success
- `201` - Created
- `400` - Bad Request (validation errors)
- `401` - Unauthorized
- `404` - Not Found
- `409` - Conflict (business rule violation)
- `500` - Internal Server Error









## Contributing

1. Fork the repository
2. Create a feature branch
3. Commit your changes
4. Push to the branch
5. Create a Pull Request

## License

MIT License