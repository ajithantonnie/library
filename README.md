# SpringBooks Library Management API

A comprehensive Spring Boot REST API for managing library operations including book management, member registration, and book borrowing/returning functionality.

## üöÄ Features

- **Book Management**: Complete CRUD operations for books
- **Member Management**: Register and manage library members
- **Business Logic**: Secure book borrowing and returning with business rules
- **Security**: OAuth2 Resource Server with JWT token validation
- **Validation**: Input validation with detailed error messages
- **Pagination**: Paginated responses for large datasets
- **API Documentation**: Swagger/OpenAPI 3 documentation
- **Database Support**: MySQL for production, H2 for development/testing
- **Comprehensive Testing**: Unit and integration tests

## üõ† Technologies Used

- **Java 17**
- **Spring Boot 3.2.0**
- **Spring Security 6** (OAuth2 Resource Server)
- **Spring Data JPA**
- **MySQL** (Production)
- **H2 Database** (Development/Testing)
- **Maven**
- **JUnit 5**
- **Mockito**
- **Swagger/OpenAPI 3**
- **Validation**: Input validation with proper error handling
- **API Documentation**: Swagger/OpenAPI 3 integration
- **Testing**: Comprehensive unit and integration tests
- **Database**: MySQL support with H2 for testing

## Technology Stack

- **Framework**: Spring Boot 3.2.0
- **Security**: Spring Security
- **Database**: MySQL (Production), H2 (Testing)
- **ORM**: JPA/Hibernate
- **Validation**: Bean Validation (Jakarta)
- **Documentation**: SpringDoc OpenAPI 3
- **Testing**: JUnit 5, Mockito, Spring Boot Test
- **Build Tool**: Maven

## üì¶ Quick Start

### Prerequisites

- Java 17 or higher
- Maven 3.6+
- MySQL 8.0+ (for production profile)

### Building the Application

```bash
# Clone the repository
git clone <your-repository-url>
cd library

# Build the application
mvn clean install

# Run tests
mvn test
```

### Running the Application

#### Development Mode (with H2 Database)

**For Windows PowerShell:**
```powershell
$env:SPRING_PROFILES_ACTIVE='h2'; .\mvnw.cmd spring-boot:run
```

**For Linux/Mac:**
```bash
SPRING_PROFILES_ACTIVE=h2 ./mvnw spring-boot:run
```

#### Production Mode (with MySQL)
```powershell
# First, ensure MySQL is running and create the database
# The application will automatically create tables

# Windows PowerShell:
.\mvnw.cmd spring-boot:run

# Linux/Mac:
./mvnw spring-boot:run
```

The application will start on `http://localhost:8080`

## üîê Authentication

This API is secured using OAuth2 Resource Server with JWT tokens. For demonstration purposes, a simple JWT configuration is provided.

### Using the API with Authentication

For testing purposes, you can use basic authentication:
- **Username**: `user`
- **Password**: `password`

#### Example with curl:
```bash
curl -u user:password http://localhost:8080/api/books
```

### JWT Token 

For demonstration purposes, you can generate a JWT token using the auth endpoint:

#### 1. Generate a JWT Token:
```bash
curl -X POST http://localhost:8080/auth/token \
  -H "Content-Type: application/json" \
  -d '{"username": "testuser"}'
```

Response:
```json
{
  "token": "eyJhbGciOiJIUzI1NiJ9...",
  "type": "Bearer",
  "expires_in": "86400"
}
```

#### 2. Use the JWT Token:
```bash
curl -H "Authorization: Bearer eyJhbGciOiJIUzI1NiJ9..." http://localhost:8080/api/books
```

**Note**: In production, JWT tokens should be generated by a proper OAuth2 authorization server.

## üìö API Endpoints

### Book Management

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/books` | Add a new book |
| GET | `/api/books` | Get all books (paginated) |
| GET | `/api/books/{id}` | Get a specific book |
| PUT | `/api/books/{id}` | Update book details |
| DELETE | `/api/books/{id}` | Delete a book |

### Member Management

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/members` | Register a new member |
| GET | `/api/members` | Get all members (paginated) |
| GET | `/api/members/{id}` | Get a specific member |
| PUT | `/api/members/{id}` | Update member details |
| DELETE | `/api/members/{id}` | Delete a member |

### Library Operations

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/api/borrow/{bookId}/member/{memberId}` | Borrow a book |
| POST | `/api/return/{bookId}` | Return a book |

### Authentication

| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | `/auth/token` | Generate JWT token (demo purposes) |

### Pagination Parameters

For GET endpoints that return lists:
- `page` - Page number (default: 0)
- `size` - Page size (default: 10)

Example: `/api/books?page=0&size=5`

## üîß API Usage Examples

### 1. Create a Book

```bash
curl -X POST http://localhost:8080/api/books \
  -H "Content-Type: application/json" \
  -H "Authorization: Basic dXNlcjpwYXNzd29yZA==" \
  -d '{
    "title": "The Great Gatsby",
    "author": "F. Scott Fitzgerald", 
    "isbn": "9780743273565"
  }'
```

### 2. Register a Member

```bash
curl -X POST http://localhost:8080/api/members \
  -H "Content-Type: application/json" \
  -H "Authorization: Basic dXNlcjpwYXNzd29yZA==" \
  -d '{
    "name": "John Doe",
    "email": "john.doe@example.com"
  }'
```

### 3. Borrow a Book

```bash
curl -X POST http://localhost:8080/api/borrow/1/member/1 \
  -H "Authorization: Basic dXNlcjpwYXNzd29yZA=="
```

### 4. Return a Book

```bash
curl -X POST http://localhost:8080/api/return/1 \
  -H "Authorization: Basic dXNlcjpwYXNzd29yZA=="
```

### 5. Get All Books (with pagination)

```bash
curl "http://localhost:8080/api/books?page=0&size=5" \
  -H "Authorization: Basic dXNlcjpwYXNzd29yZA=="
```

## üóÑ Database Access

### H2 Console (Development)

When running with the H2 profile:
- **URL**: http://localhost:8080/h2-console
- **JDBC URL**: `jdbc:h2:mem:testdb`
- **Username**: `sa`
- **Password**: (leave blank)

### MySQL (Production)

- **URL**: `jdbc:mysql://localhost:3306/librarydb`
- **Username**: `root`
- **Password**: `password`

## üìñ API Documentation

### Swagger UI
- **URL**: http://localhost:8080/swagger-ui.html
- Provides interactive API documentation and testing interface

### OpenAPI JSON
- **URL**: http://localhost:8080/v3/api-docs
- Raw OpenAPI 3 specification in JSON format

## üéØ Business Rules

### Book Borrowing Rules
1. ‚úÖ A book cannot be borrowed if it is already borrowed (`isBorrowed` is true)
2. ‚úÖ A member must exist to borrow a book
3. ‚úÖ A book must exist to be borrowed
4. ‚úÖ When successfully borrowed, the book's `isBorrowed` status is set to `true`

### Book Returning Rules
1. ‚úÖ A book cannot be returned if it is not currently borrowed
2. ‚úÖ A book must exist to be returned
3. ‚úÖ When successfully returned, the book's `isBorrowed` status is set to `false`

## üß™ Testing

The application includes comprehensive testing:

### Running Tests
```bash
# Run all tests
mvn test

# Run specific test class
mvn test -Dtest=LibraryServiceTest

# Run tests with coverage
mvn test jacoco:report
```

### Test Coverage
- ‚úÖ Unit tests for all service classes
- ‚úÖ Integration tests for all API endpoints
- ‚úÖ Security tests for authentication and authorization
- ‚úÖ Business logic validation tests
- ‚úÖ Error handling tests

## üîí Error Handling

The API provides consistent error responses:

### Error Response Format
```json
{
  "status": 404,
  "message": "Book not found with id: 1",
  "timestamp": "2025-11-16T10:30:00"
}
```

### HTTP Status Codes
- `200` - Success
- `201` - Created
- `400` - Bad Request (validation errors)
- `401` - Unauthorized
- `404` - Not Found
- `409` - Conflict (business rule violation)
- `500` - Internal Server Error

## ‚öô Configuration Profiles

### Development (H2 Database)
```bash
mvn spring-boot:run -Dspring-boot.run.profiles=h2
```

### Production (MySQL Database)
```bash
mvn spring-boot:run
```

### Test
```bash
mvn test
```

## üìä Data Models

### Book Entity
```json
{
  "id": 1,
  "title": "The Great Gatsby",
  "author": "F. Scott Fitzgerald",
  "isbn": "9780743273565",
  "borrowed": false
}
```

### Member Entity
```json
{
  "id": 1,
  "name": "John Doe",
  "email": "john.doe@example.com"
}
```

## üîç Validation Rules

### Book Validation
- `title`: Required, not blank
- `author`: Required, not blank  
- `isbn`: Required, must be 10 or 13 digits

### Member Validation
- `name`: Required, not blank
- `email`: Required, valid email format, must be unique

## üöÄ Deployment

### Docker (Optional)
```dockerfile
FROM openjdk:17-jdk-slim
COPY target/library-management-1.0.0.jar app.jar
EXPOSE 8080
ENTRYPOINT ["java","-jar","/app.jar"]
```

### Environment Variables
```bash
export SPRING_DATASOURCE_URL=jdbc:mysql://localhost:3306/librarydb
export SPRING_DATASOURCE_USERNAME=root
export SPRING_DATASOURCE_PASSWORD=password
export SPRING_PROFILES_ACTIVE=production
```

## üìû Support

For questions or issues, please contact the development team or create an issue in the repository.

---

*Built with ‚ù§Ô∏è using Spring Boot*
        ‚îú‚îÄ‚îÄ LibraryApplicationTests.java
        ‚îú‚îÄ‚îÄ controller/
        ‚îÇ   ‚îî‚îÄ‚îÄ LibraryControllerIntegrationTest.java
        ‚îî‚îÄ‚îÄ service/
            ‚îú‚îÄ‚îÄ BookServiceTest.java
            ‚îî‚îÄ‚îÄ LibraryServiceTest.java
```

## Contributing

1. Fork the repository
2. Create a feature branch
3. Commit your changes
4. Push to the branch
5. Create a Pull Request

## License

This project is licensed under the MIT License.